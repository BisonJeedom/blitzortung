<div class="eqLogic eqLogic-widget allowResize allowReorderCmd #custom_layout# #eqLogic_class# #class#"
    data-eqType="#eqType#" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#" data-version="#version#"
    data-translate-category="#translate_category#" data-category="#category#" data-tags="#tags#"
    style="width: #width#;height: #height#;#style#">
    <center class="widget-name">
        <span class="warning" title="#alert_name#">
            <i class='#alert_icon#'></i>
        </span>
        <span class="cmd refresh pull-right cursor" data-cmd_id="#refresh_id#">
            <i class="fas fa-sync"></i>
        </span>
        <span class="reportModeVisible">#name_display# <span class="object_name">#object_name#</span></span>
        <a href="#eqLink#" class="reportModeHidden">#name_display# <span class="object_name">#object_name#</span></a>
    </center>

    <center>
        <div id="counter_hidden#id#" style="margin-top: 10px;font-size :14px;display:none;">Aucun impact depuis
            #retention# heure(s) dans un rayon de #rayon#
            km
        </div>
        <div id="lastdistance_hidden#id#" style="display:none;"></div>
    </center>

    <div style="width:800px;">
        <div style="float:left;">
            <br>
            <svg height="100" width="120">
                <circle id="circleDistance-#id#" cx="60" cy="50" r="45" stroke="#CirclecolorValue#" stroke-width="2"
                    fill="none" />
                <text x="60" y="50" dominant-baseline="middle" text-anchor="middle" font-weight="normal"
                    font-size="1.2em" fill="var(--txt-color)">
                    <tspan id="circleTxtDistance-#id#" x="50%" dy="0.3em"></tspan>
                </text>
            </svg>
        </div>
        <div style="padding-top: 40px;">
            <div id="counter-#id#" class="cmd" style="margin-top: 10px;font-size :14px;">
                <span id="spanCounter-#cmdIdCounter#"></span> impacts depuis #retention# heure(s) sur un rayon de
                #rayon# km
            </div>
            <div id="evolution-#id#" class="cmd" style="margin-top: 10px;font-size :14px;">#evolution#</div>
        </div>
    </div>

    <div id="container-#id#" style="width: 100%; height: 350px;"></div>

    <div class="cursor pluginAction logoSecondary">
        <i class="icon kiko-marker-map"></i>
        <span><a href="#mapurl#" target="_blank">Ouvrir la carte sur Blitzortung</a></span>
    </div>

    <script>
        if ('#refresh_id#' != '') {
            $('.eqLogic[data-eqLogic_uid=#uid#] .refresh').on('click', function () {
                jeedom.cmd.execute({ id: '#refresh_id#' });
            });
        } else {
            $('.eqLogic[data-eqLogic_uid=#uid#] .refresh').remove();
        }

        jeedom.cmd.addUpdateFunction('#cmdIdCounter#', function (_options) {
            $('#spanCounter-#cmdIdCounter#').text(_options.display_value);
        });
        jeedom.cmd.refreshValue([{ cmd_id: '#cmdIdCounter#', display_value: '#stateCounter#' }])

        jeedom.cmd.addUpdateFunction('#cmdIdDistance#', function (_options) {
            let d = _options.display_value
            $('#circleTxtDistance-#id#').empty().append(d)
            if (d != 0) {
                $('#circleTxtDistance-#id#').append(' ' + _options.unit)
                if (d <= 10) {
                    document.getElementById("circleDistance-#id#").setAttribute("stroke", '#EA251F') // Cercle en Rouge
                } else if (d <= 30) {
                    document.getElementById("circleDistance-#id#").setAttribute("stroke", '#EA6E1E') // Cercle en Orange
                } else {
                    document.getElementById("circleDistance-#id#").setAttribute("stroke", '#DFE150') // Cercle en Jaune
                }
            } else {
                document.getElementById("circleDistance-#id#").setAttribute("stroke", '#3A5B8F')
            }
        });
        jeedom.cmd.refreshValue([{ cmd_id: '#cmdIdDistance#', display_value: '#stateDistance#', unit: '#uniteDistance#' }])

        if ('#stateCounter#' == '' || '#stateCounter#' == 0) {
            document.getElementById("counter-#id#").style.display = "none";

            document.getElementById("counter_hidden#id#").style.display = "block";
            document.getElementById("lastdistance_hidden#id#").style.display = "block";
        }

        Highcharts.chart('container-#id#', {
            chart: {
                type: 'scatter',
                zoomType: 'xy'
            },

            title: {
                style: { "color": "var(--txt-color)" },
                text: 'Impacts de foudre dans un rayon de #rayon# km'
            },

            subtitle: {
                useHTML: true,
                text: ''
            },

            credits: {
                enabled: false
            },

            yAxis: {
                title: {
                    text: 'Distance (km)'
                },
                min: 0
            },

            xAxis: {
                title: {
                    text: 'Minutes'
                },
                min: 0,
                max: #tsmax#,
                labels: {
                    formatter: function () {
                        var time = this.value;
                        var min = parseInt(time / 60);
                        return min;
                    }
                }
            },

            tooltip: {
                useHTML: true,
                headerFormat: null,
                pointFormatter: function () {
                    return this.y + ' km il y a ' + Math.round(this.x / 60, 0) + ' minutes'
                }
            },

            legend: {
                enabled: true
            },

            plotOptions: {
                scatter: {
                    marker: {
                        radius: 2.5,
                        symbol: 'circle',

                    }
                }
            },

            series: [{
                keys: ['x', 'y'],
                name: "Impacts",
                data: [#data#],
                zoneAxis: 'y',
                zones: [{
                    value: 10,
                    color: '#EA251F'
                }, {
                    value: 30,
                    color: '#EA6E1E'
                },
                {
                    color: '#DFE150'
                }]
            }]
        });
    </script>
</div>